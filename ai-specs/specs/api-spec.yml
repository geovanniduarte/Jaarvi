openapi: 3.0.0
info:
  title: Jaarvi Travel Assistant API
  description: |
    REST API for Jaarvi, a mobile travel assistant that helps travelers plan and execute trips with real-time guidance.
    
    This API follows Domain-Driven Design principles and implements a layered architecture for scalable travel management.
    
    ## Features
    - User authentication with email/password and OAuth (Google, Apple)
    - Trip creation and management with multiple destinations
    - Manual itinerary building with day-by-day activities
    - Document vault for travel documents (tickets, reservations, permits)
    - Today view for real-time trip execution
    - Destination coverage information
    
    ## MVP Phase 1 (Current)
    - Manual itinerary creation and editing
    - Document management
    - Basic trip planning features
    
    ## Phase 2 (Future)
    - AI-powered itinerary generation
    - Smart recommendations and playbooks
    - Plan B alternative suggestions
    
  version: 1.0.0
  contact:
    name: Jaarvi Development Team
  license:
    name: ISC
    
servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://api-dev.jaarvi.app
    description: Development environment
  - url: https://api-staging.jaarvi.app
    description: Staging environment
  - url: https://api.jaarvi.app
    description: Production server

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Trips
    description: Trip creation and management
  - name: Destinations
    description: Destination information and coverage
  - name: Itinerary
    description: Itinerary and day plan management
  - name: Activities
    description: Activity CRUD operations and execution
  - name: Documents
    description: Document vault management
  - name: AI (Phase 2)
    description: AI-powered features (Phase 2 only)

paths:
  # ========================================
  # Authentication Endpoints
  # ========================================
  /api/auth/register:
    post:
      summary: Register new user
      description: Create a new user account with email and password
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      summary: Login user
      description: Authenticate user with email and password
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      summary: Refresh access token
      description: Get new access token using refresh token
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Refresh token received at login
              required:
                - refreshToken
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      summary: Logout user
      description: Invalidate current session and refresh token
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logout successful
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/me:
    get:
      summary: Get current user
      description: Retrieve information about the authenticated user
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User information retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/oauth/google:
    post:
      summary: Google OAuth login
      description: Authenticate user with Google OAuth authorization code
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: Authorization code from Google OAuth
              required:
                - code
      responses:
        '200':
          description: OAuth login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid authorization code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/oauth/apple:
    post:
      summary: Apple Sign-In
      description: Authenticate user with Apple Sign-In authorization code
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: Authorization code from Apple Sign-In
              required:
                - code
      responses:
        '200':
          description: OAuth login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid authorization code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Trip Management Endpoints
  # ========================================
  /api/trips:
    get:
      summary: Get all trips
      description: Retrieve all trips for the authenticated user
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [draft, active, completed]
          description: Filter trips by status
      responses:
        '200':
          description: Trips retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trip'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new trip
      description: Create a new trip with basic information
      tags:
        - Trips
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTripRequest'
      responses:
        '201':
          description: Trip created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trip'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trips/{id}:
    get:
      summary: Get trip by ID
      description: Retrieve detailed information about a specific trip
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      responses:
        '200':
          description: Trip retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripDetail'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update trip
      description: Update trip basic information
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTripRequest'
      responses:
        '200':
          description: Trip updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trip'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete trip
      description: Delete a trip and all associated data
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      responses:
        '204':
          description: Trip deleted successfully
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trips/{id}/destinations:
    post:
      summary: Add destination to trip
      description: Add a new destination (city) to the trip
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddDestinationRequest'
      responses:
        '201':
          description: Destination added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripDestination'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Trip or city not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trips/{id}/destinations/{destinationId}:
    put:
      summary: Update destination
      description: Update destination details (dates, order)
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
        - in: path
          name: destinationId
          required: true
          schema:
            type: string
            format: uuid
          description: Destination ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDestinationRequest'
      responses:
        '200':
          description: Destination updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TripDestination'
        '404':
          description: Trip or destination not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Remove destination from trip
      description: Remove a destination and all associated itinerary data
      tags:
        - Trips
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
        - in: path
          name: destinationId
          required: true
          schema:
            type: string
            format: uuid
          description: Destination ID
      responses:
        '204':
          description: Destination removed successfully
        '404':
          description: Trip or destination not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Destination & Coverage Endpoints
  # ========================================
  /api/destinations/countries:
    get:
      summary: Get all countries
      description: Retrieve list of available countries
      tags:
        - Destinations
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Countries retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Country'

  /api/destinations/cities:
    get:
      summary: Get cities
      description: Retrieve list of cities, optionally filtered by country
      tags:
        - Destinations
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: countryId
          schema:
            type: string
            format: uuid
          description: Filter cities by country ID
      responses:
        '200':
          description: Cities retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/City'

  /api/destinations/cities/{id}/coverage:
    get:
      summary: Get city coverage
      description: Retrieve coverage level and playbook availability for a city
      tags:
        - Destinations
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: City ID
      responses:
        '200':
          description: Coverage information retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CityCoverage'
        '404':
          description: City not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Itinerary Management Endpoints
  # ========================================
  /api/trips/{id}/itinerary:
    get:
      summary: Get trip itinerary
      description: Retrieve complete itinerary for a trip with all days and activities
      tags:
        - Itinerary
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      responses:
        '200':
          description: Itinerary retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Itinerary'
        '404':
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/trips/{id}/itinerary/days:
    post:
      summary: Create day plan
      description: Create a new day plan in the itinerary
      tags:
        - Itinerary
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Trip ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDayPlanRequest'
      responses:
        '201':
          description: Day plan created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayPlan'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/itinerary/days/{dayId}:
    get:
      summary: Get day plan
      description: Retrieve a specific day plan with all activities
      tags:
        - Itinerary
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: dayId
          required: true
          schema:
            type: string
            format: uuid
          description: Day plan ID
      responses:
        '200':
          description: Day plan retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayPlan'
        '404':
          description: Day plan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update day plan
      description: Update day plan information
      tags:
        - Itinerary
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: dayId
          required: true
          schema:
            type: string
            format: uuid
          description: Day plan ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDayPlanRequest'
      responses:
        '200':
          description: Day plan updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayPlan'
        '404':
          description: Day plan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete day plan
      description: Delete a day plan and all its activities
      tags:
        - Itinerary
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: dayId
          required: true
          schema:
            type: string
            format: uuid
          description: Day plan ID
      responses:
        '204':
          description: Day plan deleted successfully
        '404':
          description: Day plan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Activity Management Endpoints
  # ========================================
  /api/itinerary/days/{dayId}/activities:
    post:
      summary: Create activity
      description: Add a new activity to a day plan
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: dayId
          required: true
          schema:
            type: string
            format: uuid
          description: Day plan ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateActivityRequest'
      responses:
        '201':
          description: Activity created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Activity'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/activities/{id}:
    get:
      summary: Get activity
      description: Retrieve detailed information about an activity
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      responses:
        '200':
          description: Activity retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityDetail'
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update activity
      description: Update activity information
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateActivityRequest'
      responses:
        '200':
          description: Activity updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Activity'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete activity
      description: Delete an activity from the itinerary
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      responses:
        '204':
          description: Activity deleted successfully
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/activities/{id}/reorder:
    patch:
      summary: Reorder activity
      description: Change the order of an activity within a day
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newSortOrder:
                  type: integer
                  minimum: 0
                  description: New position in the activity list
              required:
                - newSortOrder
      responses:
        '200':
          description: Activity reordered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Activity'
        '400':
          description: Invalid sort order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/activities/{id}/complete:
    post:
      summary: Mark activity as complete
      description: Mark an activity as completed during trip execution
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      responses:
        '200':
          description: Activity marked as complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityProgress'
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/activities/{id}/skip:
    post:
      summary: Skip activity
      description: Mark an activity as skipped during trip execution
      tags:
        - Activities
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Activity ID
      responses:
        '200':
          description: Activity marked as skipped
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityProgress'
        '404':
          description: Activity not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Document Vault Endpoints
  # ========================================
  /api/documents:
    get:
      summary: Get all documents
      description: Retrieve all documents for the authenticated user
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: tripId
          schema:
            type: string
            format: uuid
          description: Filter documents by trip ID
        - in: query
          name: type
          schema:
            type: string
            enum: [ticket, reservation, permit, passport, other]
          description: Filter documents by type
      responses:
        '200':
          description: Documents retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Document'

    post:
      summary: Upload document
      description: Upload a new travel document
      tags:
        - Documents
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Document file (PDF, JPEG, PNG)
                tripId:
                  type: string
                  format: uuid
                  description: Trip ID to associate document with
                type:
                  type: string
                  enum: [ticket, reservation, permit, passport, other]
                  description: Document type
                title:
                  type: string
                  description: Document title
                metadata:
                  type: string
                  description: Additional metadata as JSON string
              required:
                - file
                - tripId
                - type
      responses:
        '201':
          description: Document uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'
        '400':
          description: Validation error or file too large
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/documents/{id}:
    get:
      summary: Get document
      description: Retrieve document metadata and download URL
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Document ID
      responses:
        '200':
          description: Document retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentDetail'
        '404':
          description: Document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete document
      description: Delete a document and its file from storage
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Document ID
      responses:
        '204':
          description: Document deleted successfully
        '404':
          description: Document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/documents/{id}/link:
    post:
      summary: Link document to activity
      description: Create a link between a document and an activity or day plan
      tags:
        - Documents
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Document ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                activityId:
                  type: string
                  format: uuid
                  description: Activity ID to link (optional)
                dayPlanId:
                  type: string
                  format: uuid
                  description: Day plan ID to link (optional)
      responses:
        '201':
          description: Document linked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentLink'
        '404':
          description: Document, activity, or day plan not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ========================================
  # Phase 2: AI-Powered Endpoints (Future)
  # ========================================
  /api/itinerary/generate:
    post:
      summary: Generate itinerary with AI (Phase 2)
      description: |
        AI-powered itinerary generation based on trip preferences.
        **Status**: Phase 2 only - Not available in MVP
      tags:
        - AI (Phase 2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tripId:
                  type: string
                  format: uuid
                preferences:
                  type: object
                  description: User preferences and constraints
      responses:
        '201':
          description: Itinerary generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Itinerary'
        '501':
          description: Feature not implemented in MVP
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: AI-powered generation available in Phase 2

  /api/itinerary/refresh:
    post:
      summary: Refresh daily itinerary (Phase 2)
      description: |
        AI-powered start-of-day itinerary refresh with contextual recommendations.
        **Status**: Phase 2 only - Not available in MVP
      tags:
        - AI (Phase 2)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dayPlanId:
                  type: string
                  format: uuid
                context:
                  type: object
                  description: Current context (location, weather, time)
      responses:
        '200':
          description: Itinerary refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayPlan'
        '501':
          description: Feature not implemented in MVP

  /api/playbooks/{cityId}:
    get:
      summary: Get city playbooks (Phase 2)
      description: |
        Retrieve AI-powered contextual advice and playbooks for a city.
        **Status**: Phase 2 only - Not available in MVP
      tags:
        - AI (Phase 2)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: cityId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Playbooks retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
        '501':
          description: Feature not implemented in MVP

  /api/activities/{id}/plan-b:
    get:
      summary: Get Plan B alternatives (Phase 2)
      description: |
        Get alternative activity suggestions when original plan fails.
        **Status**: Phase 2 only - Not available in MVP
      tags:
        - AI (Phase 2)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Alternatives retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Activity'
        '501':
          description: Feature not implemented in MVP

# ========================================
# Component Schemas
# ========================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Authentication Schemas
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User email address
        password:
          type: string
          minLength: 8
          description: User password (min 8 characters)
        displayName:
          type: string
          description: User display name
      required:
        - email
        - password
        - displayName

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
      required:
        - email
        - password

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        accessToken:
          type: string
          description: JWT access token (expires in 15 minutes)
        refreshToken:
          type: string
          description: JWT refresh token (expires in 7 days)
      required:
        - user
        - accessToken
        - refreshToken

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
        emailVerifiedAt:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          enum: [active, disabled]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # Trip Schemas
    CreateTripRequest:
      type: object
      properties:
        name:
          type: string
          description: Trip name
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
      required:
        - startDate
        - endDate

    UpdateTripRequest:
      type: object
      properties:
        name:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        status:
          type: string
          enum: [draft, active, completed]

    Trip:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ownerId:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        status:
          type: string
          enum: [draft, active, completed]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TripDetail:
      allOf:
        - $ref: '#/components/schemas/Trip'
        - type: object
          properties:
            destinations:
              type: array
              items:
                $ref: '#/components/schemas/TripDestination'

    AddDestinationRequest:
      type: object
      properties:
        cityId:
          type: string
          format: uuid
        dayOrder:
          type: integer
          minimum: 1
        daysCount:
          type: integer
          minimum: 1
      required:
        - cityId
        - dayOrder
        - daysCount

    UpdateDestinationRequest:
      type: object
      properties:
        dayOrder:
          type: integer
          minimum: 1
        daysCount:
          type: integer
          minimum: 1

    TripDestination:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
        cityId:
          type: string
          format: uuid
        city:
          $ref: '#/components/schemas/City'
        dayOrder:
          type: integer
        daysCount:
          type: integer
        notes:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # Destination Schemas
    Country:
      type: object
      properties:
        id:
          type: string
          format: uuid
        isoCode:
          type: string
          description: ISO country code
        name:
          type: string
        createdAt:
          type: string
          format: date-time

    City:
      type: object
      properties:
        id:
          type: string
          format: uuid
        countryId:
          type: string
          format: uuid
        name:
          type: string
        timezone:
          type: string
          description: IANA timezone identifier
        country:
          $ref: '#/components/schemas/Country'
        createdAt:
          type: string
          format: date-time

    CityCoverage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        cityId:
          type: string
          format: uuid
        level:
          type: string
          enum: [high, medium, low]
          description: Coverage quality level
        notes:
          type: string
          description: Coverage notes and playbook availability
        updatedAt:
          type: string
          format: date-time

    # Itinerary Schemas
    Itinerary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
        version:
          type: integer
        source:
          type: string
          enum: [manual, ai, mixed]
        status:
          type: string
          enum: [draft, ready, archived]
        dayPlans:
          type: array
          items:
            $ref: '#/components/schemas/DayPlan'
        createdAt:
          type: string
          format: date-time

    CreateDayPlanRequest:
      type: object
      properties:
        cityId:
          type: string
          format: uuid
        dayDate:
          type: string
          format: date
      required:
        - cityId
        - dayDate

    UpdateDayPlanRequest:
      type: object
      properties:
        status:
          type: string
          enum: [pending, planned, completed]

    DayPlan:
      type: object
      properties:
        id:
          type: string
          format: uuid
        itineraryVersionId:
          type: string
          format: uuid
        cityId:
          type: string
          format: uuid
        city:
          $ref: '#/components/schemas/City'
        dayDate:
          type: string
          format: date
        status:
          type: string
          enum: [pending, planned, completed]
        activities:
          type: array
          items:
            $ref: '#/components/schemas/Activity'
        refreshedAt:
          type: string
          format: date-time
          nullable: true

    # Activity Schemas
    CreateActivityRequest:
      type: object
      properties:
        activityTypeKey:
          type: string
          description: Activity type key from ActivityTypeConfig
        type:
          type: string
          enum: [transfer, visit, meal, freeTime, booking, other]
        title:
          type: string
        locationName:
          type: string
          nullable: true
        startTime:
          type: string
          format: date-time
          nullable: true
        endTime:
          type: string
          format: date-time
          nullable: true
        costEstimate:
          type: number
          format: decimal
          nullable: true
        sortOrder:
          type: integer
          minimum: 0
      required:
        - activityTypeKey
        - type
        - title

    UpdateActivityRequest:
      type: object
      properties:
        title:
          type: string
        locationName:
          type: string
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time
        costEstimate:
          type: number
          format: decimal
        isMandatory:
          type: boolean
        readinessStatus:
          type: string
          enum: [pending, planned, prepared, notNeeded]
        readinessNote:
          type: string

    Activity:
      type: object
      properties:
        id:
          type: string
          format: uuid
        dayPlanId:
          type: string
          format: uuid
        activityTypeKey:
          type: string
        type:
          type: string
          enum: [transfer, visit, meal, freeTime, booking, other]
        title:
          type: string
        locationName:
          type: string
          nullable: true
        costEstimate:
          type: number
          format: decimal
          nullable: true
        startTime:
          type: string
          format: date-time
          nullable: true
        endTime:
          type: string
          format: date-time
          nullable: true
        sortOrder:
          type: integer
        isMandatory:
          type: boolean
        readinessStatus:
          type: string
          enum: [pending, planned, prepared, notNeeded]
        readinessNote:
          type: string
          nullable: true
        preparedAt:
          type: string
          format: date-time
          nullable: true

    ActivityDetail:
      allOf:
        - $ref: '#/components/schemas/Activity'
        - type: object
          properties:
            documents:
              type: array
              items:
                $ref: '#/components/schemas/Document'
            progress:
              $ref: '#/components/schemas/ActivityProgress'

    ActivityProgress:
      type: object
      properties:
        id:
          type: string
          format: uuid
        activityId:
          type: string
          format: uuid
        status:
          type: string
          enum: [notStarted, inProgress, done, skipped]
        startedAt:
          type: string
          format: date-time
          nullable: true
        completedAt:
          type: string
          format: date-time
          nullable: true

    # Document Schemas
    Document:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
        type:
          type: string
          enum: [ticket, reservation, permit, passport, other]
        title:
          type: string
        storageProvider:
          type: string
          description: Storage provider (e.g., s3)
        storageKey:
          type: string
          description: Storage key/path
        checksum:
          type: string
          description: File checksum for integrity
        metadataJson:
          type: object
          description: Additional metadata
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    DocumentDetail:
      allOf:
        - $ref: '#/components/schemas/Document'
        - type: object
          properties:
            downloadUrl:
              type: string
              format: uri
              description: Temporary signed URL for download
            links:
              type: array
              items:
                $ref: '#/components/schemas/DocumentLink'

    DocumentLink:
      type: object
      properties:
        id:
          type: string
          format: uuid
        documentId:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
        dayPlanId:
          type: string
          format: uuid
          nullable: true
        activityId:
          type: string
          format: uuid
          nullable: true
        createdAt:
          type: string
          format: date-time

    # Error Schema
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          description: Error message
        error:
          type: string
          description: Detailed error information
        code:
          type: string
          description: Error code
      required:
        - message
